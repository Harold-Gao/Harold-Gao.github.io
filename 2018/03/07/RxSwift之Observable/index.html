<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="iOS, Swift"><title>RxSwift之Observable - Harold-Diary</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/github_logo.png"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://op6guxky2.bkt.clouddn.com/post_background.jpg"><div class="post-title"><h1 class="title">RxSwift之Observable</h1><ul class="meta"><li><i class="icon icon-author"></i>Harold.Gao</li><li><i class="icon icon-clock"></i>32 Minutes</li><li><i class="icon icon-calendar"></i>March 7, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h2><h4 id="Observable-是可以产生事件序列的发射器。"><a href="#Observable-是可以产生事件序列的发射器。" class="headerlink" title="Observable 是可以产生事件序列的发射器。"></a>Observable 是可以产生事件序列的发射器。</h4><p><strong>事件有3种类型</strong></p>
<blockquote>
<p>next 事件会包含相关内容(整数值、实例对象…)</p>
<p>error 事件包含错误信息，表示observable发生错误。</p>
<p>completed  事件表示observable完成使命。</p>
</blockquote>
<p>在发送error事件或completed事件后，observable都会停止发送事件。</p>
<h4 id="Observable-示例"><a href="#Observable-示例" class="headerlink" title="Observable 示例"></a>Observable 示例</h4><p><strong>帮助方法</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">example</span><span class="params">(of description: String, action: <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n--- Example of:"</span>, description, <span class="string">"---"</span>)</span><br><span class="line">    action()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建observale的方法</strong></p>
<blockquote>
<p>just 事件序列包含一个元素</p>
<p>of 事件序列的元素是传入的可变参数，传入多少个参数，序列就有多少个元素</p>
<p>from 事件序列的元素由传入的数组确定</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建observable</span></span><br><span class="line">example(of: <span class="string">"just, of, from"</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> one = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> two = <span class="number">2</span></span><br><span class="line">    <span class="keyword">let</span> three = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.just(one)</span><br><span class="line">    <span class="keyword">let</span> observable2 = <span class="type">Observable</span>.of(one, two, three)</span><br><span class="line">    <span class="keyword">let</span> observable3 = <span class="type">Observable</span>.of([one, two, three])</span><br><span class="line">    <span class="keyword">let</span> observable4 = <span class="type">Observable</span>.from([one, two, three])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Subscribe to Observable</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅observable</span></span><br><span class="line">example(of: <span class="string">"subscribe"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> one = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> two = <span class="number">2</span></span><br><span class="line">    <span class="keyword">let</span> three = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>.of(one, two, three)</span><br><span class="line"></span><br><span class="line">    observable.subscribe &#123; (event) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: subscribe ---</span><br><span class="line">next(<span class="number">1</span>)</span><br><span class="line">next(<span class="number">2</span>)</span><br><span class="line">next(<span class="number">3</span>)</span><br><span class="line">completed</span><br></pre></td></tr></table></figure>
<p><strong>获取事件中的元素</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅observable</span></span><br><span class="line">example(of: <span class="string">"subscribe"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> one = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> two = <span class="number">2</span></span><br><span class="line">    <span class="keyword">let</span> three = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>.of(one, two, three)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    observable.subscribe &#123; (event) in</span></span><br><span class="line"><span class="comment">//        if let element = event.element &#123;</span></span><br><span class="line"><span class="comment">//            print(element)</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    observable.subscribe(onNext: &#123; (element) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(element)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: subscribe ---</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p><strong>两个奇怪的Observable类型</strong></p>
<blockquote>
<p>empty 只产生一个completed事件</p>
<p>never  从不终止</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">example(of: <span class="string">"empty"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>&lt;<span class="type">Void</span>&gt;.empty()</span><br><span class="line"></span><br><span class="line">    observable</span><br><span class="line">        .subscribe(onNext: &#123; element <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(element)</span><br><span class="line">        &#125;,</span><br><span class="line">        onCompleted: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Completed"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">example(of: <span class="string">"never"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>&lt;<span class="type">Any</span>&gt;.never()</span><br><span class="line"></span><br><span class="line">    observable</span><br><span class="line">        .subscribe(onNext: &#123; (element) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(element)</span><br><span class="line">        &#125;,</span><br><span class="line">        onCompleted: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Completed"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: empty ---</span><br><span class="line"><span class="type">Completed</span></span><br><span class="line"></span><br><span class="line">--- <span class="type">Example</span> of: never ---</span><br></pre></td></tr></table></figure>
<p><strong>使用range操作符创建observable</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成斐波那契数列</span></span><br><span class="line">example(of: <span class="string">"range"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.range(start: <span class="number">1</span>, <span class="built_in">count</span>: <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    observable.subscribe(onNext: &#123; (element) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> n = <span class="type">Double</span>(element)</span><br><span class="line">        <span class="keyword">let</span> fibonacci = <span class="type">Int</span>(((pow(<span class="number">1.61803</span>, n) - pow(<span class="number">0.61803</span>, n)) / <span class="number">2.23606</span>).rounded())</span><br><span class="line">        <span class="built_in">print</span>(fibonacci)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: range ---</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="number">55</span></span><br></pre></td></tr></table></figure>
<p><strong>取消订阅</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动取消</span></span><br><span class="line">example(of: <span class="string">"dispose"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> observable = <span class="type">Observable</span>.of(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> subscription = observable.subscribe &#123; (event) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    subscription.dispose()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加入disposeBag，在disposeBag被销毁时取消订阅</span></span><br><span class="line">example(of: <span class="string">"DisposeBag"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">    <span class="type">Observable</span>.of(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用create操作符创建observable</strong></p>
<p>create操作符确定了订阅者可以收到的事件序列</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">MyError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> anError</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">example(of: <span class="string">"create"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">    <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create(&#123; observer <span class="keyword">in</span></span><br><span class="line">        observer.onNext(<span class="string">"1"</span>)</span><br><span class="line"><span class="comment">//        observer.onError(MyError.anError)</span></span><br><span class="line">        observer.onCompleted()</span><br><span class="line">        observer.onNext(<span class="string">"?"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">    &#125;).subscribe(</span><br><span class="line">        onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span><br><span class="line">        onError: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span><br><span class="line">        onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;,</span><br><span class="line">        onDisposed: &#123; <span class="built_in">print</span>(<span class="string">"Disposed"</span>) &#125;</span><br><span class="line">    ).disposed(by: disposeBag)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: create ---</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="type">Completed</span></span><br><span class="line"><span class="type">Disposed</span></span><br></pre></td></tr></table></figure>
<p><strong>使用deffered操作符创建observable工厂</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">example(of: <span class="string">"deffered"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> flip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> factory = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.deferred &#123;</span><br><span class="line">        flip = !flip</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flip &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Observable</span>.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">1</span>...<span class="number">4</span> &#123;</span><br><span class="line">        factory.subscribe(onNext: &#123; (element) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(element, terminator: <span class="string">" "</span>)</span><br><span class="line">        &#125;).disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">--- <span class="type">Example</span> of: deffered ---</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> </span><br><span class="line"><span class="number">4</span> <span class="number">5</span> <span class="number">6</span> </span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> </span><br><span class="line"><span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p><strong>三个特性Observable</strong></p>
<blockquote>
<p>Single 只产生一次success(value)事件或error事件</p>
<p>Completable 只产生一次completed事件或error事件</p>
<p>Maybe 事件包含元素时产生success(value)，不包含元素时产生completed事件，或者产生error事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">example(of: <span class="string">"Single"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">FileReadError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> fileNotFound, unreadable, encodingFailed</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadText</span><span class="params">(from name: String)</span></span> -&gt; <span class="type">Single</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Single</span>.create(subscribe: &#123; single <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> disposable = <span class="type">Disposables</span>.create()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> path = <span class="type">Bundle</span>.main.path(forResource: name, ofType: <span class="string">"txt"</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">                single(.error(<span class="type">FileReadError</span>.fileNotFound))</span><br><span class="line">                <span class="keyword">return</span> disposable</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> data = <span class="type">FileManager</span>.<span class="keyword">default</span>.contents(atPath: path) <span class="keyword">else</span> &#123;</span><br><span class="line">                single(.error(<span class="type">FileReadError</span>.unreadable))</span><br><span class="line">                <span class="keyword">return</span> disposable</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> contents = <span class="type">String</span>(data: data, encoding: .utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">                single(.error(<span class="type">FileReadError</span>.encodingFailed))</span><br><span class="line">                <span class="keyword">return</span> disposable</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            single(.success(contents))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> disposable</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    loadText(from: <span class="string">"fileInfo"</span>).subscribe(onSuccess: &#123; (contents) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(contents)</span><br><span class="line">    &#125;, onError: &#123; (error) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(error)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxSwift/">RxSwift</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">3</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/03/09/RxSwift之Subject/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/02/18/有时觉得自己是世界上最闲的人/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/egetart" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="mailto:harold_gao@163.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li><li><a href="https://www.segmentfault.com/u/bon" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 Harold-Diary<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>